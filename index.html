<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>AdhanSalat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="manifest.json" />
</head>
<body>
  <h1>ğŸ•Œ AdhanSalat - Horaires de priÃ¨re</h1>

  <label>Pays/Ville :
    <select id="citySelector">
      <option value="">-- Choisir --</option>
      <option value="43.61,3.87">ğŸ‡«ğŸ‡· Montpellier</option>
      <option value="48.86,2.35">ğŸ‡«ğŸ‡· Paris</option>
      <option value="45.76,4.84">ğŸ‡«ğŸ‡· Lyon</option>
      <option value="43.29,5.37">ğŸ‡«ğŸ‡· Marseille</option>
      <option value="36.75,3.04">ğŸ‡©ğŸ‡¿ Alger</option>
      <option value="33.57,-7.59">ğŸ‡²ğŸ‡¦ Casablanca</option>
      <option value="24.71,46.67">ğŸ‡¸ğŸ‡¦ Riyadh</option>
      <option value="21.42,39.83">ğŸ‡¸ğŸ‡¦ La Mecque</option>
      <option value="31.96,35.93">ğŸ‡¯ğŸ‡´ Amman</option>
      <option value="40.71,-74.01">ğŸ‡ºğŸ‡¸ New York</option>
    </select>
  </label><br>

  <label>Latitude : <input id="lat" type="number" value="43.61" step="0.01" /></label><br>
  <label>Longitude : <input id="lon" type="number" value="3.87" step="0.01" /></label><br>
  <label>Angle Fajr : <input id="fajr" type="number" value="18" /></label><br>
  <label>Angle Isha : <input id="isha" type="number" value="17" /></label><br>
  <label>OU Ã©cart Isha (minutes) : <input id="ishaInterval" type="number" value="0" /></label><br><br>

  <h3>Ajustements manuels (Â±15min)</h3>
  <label>Fajr : <select id="fajrAdjust"></select></label><br>
  <label>Dhuhr : <select id="dhuhrAdjust"></select></label><br>
  <label>Asr : <select id="asrAdjust"></select></label><br>
  <label>Maghrib : <select id="maghribAdjust"></select></label><br>
  <label>Isha : <select id="ishaAdjust"></select></label><br><br>

  <button onclick="calculate()">Calculer</button>

  <h2>Horaires :</h2>
  <ul id="times"></ul>

  <script src="adhan.js"></script>
  <script>
    function formatTime(date) {
      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    function generateAdjustmentOptions(id) {
      const select = document.getElementById(id);
      select.innerHTML = "";
      for (let i = -15; i <= 15; i++) {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = (i > 0 ? "+" : "") + i + " min";
        if (i === 0) opt.selected = true;
        select.appendChild(opt);
      }
    }

    function calculate() {
      const lat = parseFloat(document.getElementById("lat").value);
      const lon = parseFloat(document.getElementById("lon").value);
      const fajrAngle = parseFloat(document.getElementById("fajr").value);
      const ishaAngle = parseFloat(document.getElementById("isha").value);
      const ishaInterval = parseInt(document.getElementById("ishaInterval").value);

      const coordinates = new adhan.Coordinates(lat, lon);
      const params = new adhan.CalculationParameters("Other", fajrAngle, ishaAngle);
      params.madhab = adhan.Madhab.Shafi;

      if (ishaInterval > 0) {
        params.ishaAngle = 0;
        params.ishaInterval = ishaInterval;
      }

      // Appliquer les ajustements
      params.adjustments.fajr = parseInt(document.getElementById("fajrAdjust").value);
      params.adjustments.dhuhr = parseInt(document.getElementById("dhuhrAdjust").value);
      params.adjustments.asr = parseInt(document.getElementById("asrAdjust").value);
      params.adjustments.maghrib = parseInt(document.getElementById("maghribAdjust").value);
      params.adjustments.isha = parseInt(document.getElementById("ishaAdjust").value);

      const date = new Date();
      const prayerTimes = new adhan.PrayerTimes(coordinates, date, params);

      const times = {
        Fajr: formatTime(prayerTimes.fajr),
        Sunrise: formatTime(prayerTimes.sunrise),
        Dhuhr: formatTime(prayerTimes.dhuhr),
        Asr: formatTime(prayerTimes.asr),
        Maghrib: formatTime(prayerTimes.maghrib),
        Isha: formatTime(prayerTimes.isha)
      };

      const list = document.getElementById("times");
      list.innerHTML = "";
      for (const [name, time] of Object.entries(times)) {
        const li = document.createElement("li");
        li.textContent = `${name} : ${time}`;
        list.appendChild(li);
      }
    }

    // Init des options dâ€™ajustement au chargement
    window.onload = () => {
      ["fajrAdjust", "dhuhrAdjust", "asrAdjust", "maghribAdjust", "ishaAdjust"].forEach(generateAdjustmentOptions);
      calculate();
    };

    document.getElementById("citySelector").addEventListener("change", e => {
      const value = e.target.value;
      if (value) {
        const [lat, lon] = value.split(",");
        document.getElementById("lat").value = lat;
        document.getElementById("lon").value = lon;
        calculate();
      }
    });

    // ExclusivitÃ© angle / intervalle Isha
    document.getElementById("ishaInterval").addEventListener("input", e => {
      document.getElementById("isha").disabled = parseInt(e.target.value) > 0;
    });
    document.getElementById("isha").addEventListener("input", e => {
      document.getElementById("ishaInterval").disabled = parseFloat(e.target.value) > 0;
    });
  </script>
</body>
</html>
